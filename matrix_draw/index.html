<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix Code Gen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: #eee; font-family: monospace; }
        .pixel-grid {
            display: grid;
            gap: 1px;
            background-color: #222;
            border: 2px solid #333;
            user-select: none;
            width: fit-content;
        }
        .pixel {
            width: 24px;
            height: 24px;
            background-color: #111;
            cursor: crosshair;
        }
        .pixel:hover { background-color: #333; }
        .pixel.active { box-shadow: inset 0 0 8px rgba(255,255,255,0.2); }
    </style>
</head>
<body class="p-8">
    <div class="max-w-7xl mx-auto flex flex-col gap-8">
        <div class="flex flex-wrap items-end justify-between gap-4 bg-zinc-900 p-6 rounded-xl border border-zinc-800">
            <div class="flex gap-6">
                <div class="flex flex-col gap-2">
                    <label class="text-xs font-bold text-zinc-500 uppercase">Size</label>
                    <select id="gridSize" onchange="initGrid()" class="bg-black border border-zinc-700 p-2 rounded text-lg outline-none">
                        <option value="8">8x8</option>
                        <option value="16" selected>16x16</option>
                        <option value="32">32x32</option>
                    </select>
                </div>
                <div class="flex flex-col gap-2">
                    <label class="text-xs font-bold text-zinc-500 uppercase">Color</label>
                    <input type="color" id="brushColor" value="#00ff00" class="bg-transparent h-12 w-20 border-none cursor-pointer">
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="clearGrid()" class="bg-zinc-800 hover:bg-zinc-700 px-6 py-3 rounded-lg text-lg transition">üóëÔ∏è</button>
                <button onclick="copyCode()" class="bg-blue-600 hover:bg-blue-500 px-8 py-3 rounded-lg text-lg font-bold transition">üìã Copy C++</button>
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 items-start">
            <div id="gridContainer" class="bg-zinc-900 p-4 rounded-xl border border-zinc-800 overflow-auto flex justify-center max-h-[70vh]">
                <div id="pixelGrid" class="pixel-grid"></div>
            </div>

            <div class="bg-zinc-950 p-6 rounded-xl border border-zinc-900 h-full min-h-[400px]">
                <pre id="codeOutput" class="text-base text-blue-400 overflow-auto whitespace-pre-wrap leading-relaxed"></pre>
            </div>
        </div>
    </div>

    <script>
        let isDrawing = false;
        let pixels = new Map();
        const grid = document.getElementById('pixelGrid');
        const output = document.getElementById('codeOutput');
        const sizeSelect = document.getElementById('gridSize');
        const colorInput = document.getElementById('brushColor');

        function initGrid() {
            const size = parseInt(sizeSelect.value);
            grid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            grid.innerHTML = '';
            pixels.clear();
            
            for (let y = 0; y < size; y++) {
                for (let x = 0; x < size; x++) {
                    const p = document.createElement('div');
                    p.className = 'pixel';
                    p.dataset.x = x;
                    p.dataset.y = y;
                    p.onmousedown = (e) => { isDrawing = true; paint(p, e.shiftKey); };
                    p.onmouseenter = (e) => { if (isDrawing) paint(p, e.shiftKey); };
                    grid.appendChild(p);
                }
            }
            window.onmouseup = () => isDrawing = false;
            updateCode();
        }

        function paint(el, erase) {
            const key = `${el.dataset.x},${el.dataset.y}`;
            if (erase) {
                pixels.delete(key);
                el.style.backgroundColor = '';
                el.classList.remove('active');
            } else {
                const color = colorInput.value;
                pixels.set(key, color);
                el.style.backgroundColor = color;
                el.classList.add('active');
            }
            updateCode();
        }

        function hexTo565(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `_matrix->color565(${r}, ${g}, ${b})`;
        }

        function updateCode() {
            if (pixels.size === 0) {
                output.textContent = "// Start drawing...";
                return;
            }

            let code = `void drawIcon(int16_t x, int16_t y) {\n`;
            const colorGroups = {};
            
            pixels.forEach((color, pos) => {
                if (!colorGroups[color]) colorGroups[color] = [];
                colorGroups[color].push(pos);
            });

            Object.entries(colorGroups).forEach(([color, coords]) => {
                code += `    uint16_t c = ${hexTo565(color)};\n`;
                coords.forEach(pos => {
                    const [px, py] = pos.split(',');
                    code += `    _matrix->drawPixel(x + ${px}, y + ${py}, c);\n`;
                });
            });
            
            code += `}`;
            output.textContent = code;
        }

        function clearGrid() {
            document.querySelectorAll('.pixel').forEach(p => {
                p.style.backgroundColor = '';
                p.classList.remove('active');
            });
            pixels.clear();
            updateCode();
        }

        function copyCode() {
            const dummy = document.createElement("textarea");
            document.body.appendChild(dummy);
            dummy.value = output.textContent;
            dummy.select();
            document.execCommand("copy");
            document.body.removeChild(dummy);
        }

        initGrid();
    </script>
</body>
</html>
